---
title: 手写瀑布流
tags: JS
---

瀑布流是我们经常用到的效果，它有一个特点就是`等宽不定高`

那我们如何实现一个这样的效果呢，我们一步一步来做一下

<!-- more -->

首先我们准备容器样式和模拟数据：

```html
<style>
    html, body, .container {
        margin: 0;
        height: 100vh;
    }
    .container {
        position: relative;
    }
    .container div {
        position: absolute;
        width: 120px;
    }
</style>

<div class="container"></div>

<script>
    let list =  [
        {
            height: 300,
            background: 'red'
        },
        ...
        ...
        {
            height: 400,
            background: 'pink'
        },
     ]
</script>
```

`list`就是我们希望渲染到页面的数据，但是我们不能直接循环渲染到页面，我们需要调整调整数组顺序，计算每一项元素的位置，我们准备一个`renderList` 来盛放新数据，我们还需要准备一个`heightList`来盛放每一行的各个元素的高度。

```js
let renderList = []  // 用来盛放要渲染的数组
let heightList = []  // 盛放每一行元素的高度
```

那一行到底盛放几个元素呢，我们暂定元素宽度`130px`，那就是页面宽度`document.body.clientWidth`除元素宽度

```js
let column = Math.floor(document.body.clientWidth / 130)  // 一行几列
```

接下来就是循环`list` 先丢满一整行，并记录位置`left`、`top`

```js
list.forEach((item, index) => {
    if(index < column) {
        item.top = 0
        item.left = 130 * index

        renderList.push(item)
        heightList.push(item.height)  // 记录下一整行各个元素的高度
    }
})
```

`renderList`第一行数据我们准备好了，渲染到页面看下效果

```js
let result = ``

renderList.forEach(item => {
    result += `<div style="
        height: ${item.height}px; 
        background: ${item.background}; 
        left: ${item.left}px; 
        top: ${item.top}px">
	</div>`
})

document.querySelector('.container').innerHTML = result
```

第一行搞定了😊

接下来难点来了，我们需要接着循环`list`数据并找高度最小的那一列，把数据放到高度最小的下边，以此类推，直到`list`所有数据循环完毕，并每一次都放到重新计算了最小列的下边。

```js
list.forEach((item, index) => {
    if(index < column) {
        item.top = 0
        item.left = 130 * index

        renderList.push(item)
        heightList.push(item.height)  // 记录下一整行各个元素的高度
    } else {  // 数据超过第一行，就需要逐个元素去判断放置的位置
        let shotHeight = heightList[0]  // 假设第一个是最小高度
        let shotIndex = 0  // 假设最小高度的列索引

        heightList.forEach((heightItem, heightIndex) => {  // 循环遍历高度列表
            if(shotHeight > heightItem) {  // 当高度小于标识 则替换
                shotHeight = heightItem
                shotIndex = heightIndex
            }
        })

        item.left = 130 * shotIndex  // 设置最小高度列的左偏移
        item.top = shotHeight + 10  // 给最小高度列下边 并留10px 间距

        renderList.push(item)  // 将元素 放到渲染数组

        heightList[shotIndex] = shotHeight + item.height  // 更新heightlist高度列表
    }
})
```

再次查看效果,成功了。

我们希望页面大小改变重新计算并排列，贴上完整代码：

```js
let list =  [
      {
          height: 300,
          background: 'red'
      },
   	  ...
      ...
      {
        height: 400,
        background: 'skyblue'
      }
    ]

    function renderListFn () {
      let renderList = []  // 用来盛放要渲染的数组
      let heightList = []  // 盛放每一行元素的高度

      let column = Math.floor(document.body.clientWidth / 130)  // 一行几列

      list.forEach((item, index) => {
        if(index < column) {
          item.top = 0
          item.left = 130 * index

          renderList.push(item)
          heightList.push(item.height)  // 记录下一整行各个元素的高度
        } else {  // 数据超过第一行，就需要逐个元素去判断放置的位置
          let shotHeight = heightList[0]  // 假设第一个是最小高度
          let shotIndex = 0  // 假设最小高度的列索引

          heightList.forEach((heightItem, heightIndex) => {  // 循环遍历高度列表
            if(shotHeight > heightItem) {  // 当高度小于标识 则替换
              shotHeight = heightItem
              shotIndex = heightIndex
            }
          })

          item.left = 130 * shotIndex  // 设置最小高度列的左偏移
          item.top = shotHeight + 10  // 给最小高度列下边 并留10px 间距

          renderList.push(item)  // 将元素 放到渲染数组

          heightList[shotIndex] = shotHeight + item.height  // 更新heightlist高度列表


        }
      })

      let result = ``

      renderList.forEach(item => {
        result += `<div style="
          height: ${item.height}px; 
          background: ${item.background}; 
          left: ${item.left}px; 
          top: ${item.top}px"></div>`
      })

      document.querySelector('.container').innerHTML = result
    }

    renderListFn()

    window.onresize = renderListFn
```

